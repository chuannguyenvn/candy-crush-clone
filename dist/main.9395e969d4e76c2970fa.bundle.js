(()=>{"use strict";var e,t={447:(e,t,s)=>{var i,a=s(260);class n extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}!function(e){let t,s,i;!function(e){e.BOOT="scene.boot",e.LOAD="scene.load",e.PLAY="scene.play"}(t=e.Scene||(e.Scene={})),function(e){e.COOKIE_1="cookie1",e.COOKIE_2="cookie2",e.CROISSANT="croissant",e.CUPCAKE="cupcake",e.DONUT="donut",e.ECLAIR="eclair",e.MACAROON="macaroon",e.PIE="pie",e.POPTART_1="poptart1",e.POPTART_2="poptart2",e.STAR_COOKIE_1="starcookie1",e.STAR_COOKIE_2="starcookie2",e.AVOCADO="avocado",e.BANANA="banana",e.CHESTNUT="chestnut",e.GRAPES="grapes",e.STRAWBERRY="strawberry",e.FIRE="fire",e.BOLT="bolt",e.STAR="star",e.PROGRESS_STAR="progress-star",e.CONFETTI="confetti",e.CONFETTI_FLIPPED="confetti-flipped"}(s=e.Sprite||(e.Sprite={})),i=e.Audio||(e.Audio={})}(i||(i={}));const r=i,h={SCORE:0,HIGH_SCORE:0,GRID_WIDTH:8,GRID_HEIGHT:8,TILE_WIDTH:64,TILE_HEIGHT:64,CANDY_TYPES:[r.Sprite.AVOCADO,r.Sprite.BANANA,r.Sprite.CHESTNUT,r.Sprite.GRAPES,r.Sprite.STRAWBERRY]};class o{constructor(e,t){this.state=e,this.callback=t}}const l=class{static shuffleArray(e){const t=[...e];for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[s],t[s]=i}return t}static getRandomElement(e){return e[Math.floor(Math.random()*e.length)]}};class c{constructor(e){this.matchesOfThree=[],this.matchesOfFour=[],this.matchesOfFiveStraight=[],this.matchesOfFiveAngled=[],this.totalMatches=0,this.matchesOfFiveAngled=l.shuffleArray(this.findMatchesOfFiveAngled(e)),this.matchesOfFiveStraight=l.shuffleArray(this.findMatchesOfFiveStraight(e)),this.matchesOfFour=l.shuffleArray(this.findMatchesOfFour(e)),this.matchesOfThree=l.shuffleArray(this.findMatchesOfThree(e)),this.totalMatches=this.matchesOfThree.length+this.matchesOfFour.length+this.matchesOfFiveStraight.length+this.matchesOfFiveAngled.length}findMatchesOfThree(e){const t=[];for(let s=0;s<e[0].length;s++)for(let i=0;i<e.length-2;i++){const a=e[i][s],n=e[i+1][s],r=e[i+2][s];if(a.canMatchWith(n)&&n.canMatchWith(r)){const e=[a,n,r];t.push(new d(e))}}for(let s=0;s<e.length;s++){const i=e[s];for(let e=0;e<i.length-2;e++){const s=i[e],a=i[e+1],n=i[e+2];if(s.canMatchWith(a)&&a.canMatchWith(n)){const e=[s,a,n];t.push(new d(e))}}}return t}findMatchesOfFour(e){const t=[];for(let s=0;s<e[0].length;s++)for(let i=0;i<e.length-3;i++){const a=e[i][s],n=e[i+1][s],r=e[i+2][s],h=e[i+3][s];if(a.canMatchWith(n)&&n.canMatchWith(r)&&r.canMatchWith(h)){const e=[a,n,r,h];t.push(new g(e))}}for(let s=0;s<e.length;s++){const i=e[s];for(let e=0;e<i.length-3;e++){const s=i[e],a=i[e+1],n=i[e+2],r=i[e+3];if(s.canMatchWith(a)&&a.canMatchWith(n)&&n.canMatchWith(r)){const e=[s,a,n,r];t.push(new g(e))}}}return t}findMatchesOfFiveStraight(e){const t=[];for(let s=0;s<e[0].length;s++)for(let i=0;i<e.length-4;i++){const a=e[i][s],n=e[i+1][s],r=e[i+2][s],h=e[i+3][s],o=e[i+4][s];if(a.canMatchWith(n)&&n.canMatchWith(r)&&r.canMatchWith(h)&&h.canMatchWith(o)){const e=[a,n,r,h,o];t.push(new u(e))}}for(let s=0;s<e.length;s++){const i=e[s];for(let e=0;e<i.length-4;e++){const s=i[e],a=i[e+1],n=i[e+2],r=i[e+3],h=i[e+4];if(s.canMatchWith(a)&&a.canMatchWith(n)&&n.canMatchWith(r)&&r.canMatchWith(h)){const e=[s,a,n,r,h];t.push(new u(e))}}}return t}findMatchesOfFiveAngled(e){const t=[],s=[["0","1","0","1","1","1","0","1","0"],["1","1","1","0","1","0","0","1","0"],["0","1","0","0","1","0","1","1","1"],["1","0","0","1","1","1","1","0","0"],["0","0","1","1","1","1","0","0","1"],["1","0","0","1","0","0","1","1","1"],["0","0","1","0","0","1","1","1","1"],["1","1","1","1","0","0","1","0","0"],["1","1","1","0","0","1","0","0","1"]];for(let i=0;i<e.length-2;i++){const a=e[i];for(let n=0;n<a.length-2;n++){const a=[];for(let t=0;t<3;t++)for(let s=0;s<3;s++){const r=e[i+t][n+s];a.push(r?r.tileType:"")}for(const r of s){const s=r.find((e=>"0"!==e));if(!s)continue;let h=!0;for(let e=0;e<r.length;e++)if("1"===r[e]&&a[e]!==s){h=!1;break}if(h){const s=[];for(let t=0;t<9;t++){const a=e[i+Math.floor(t/3)][n+t%3];s.push(a)}t.push(new T(s));break}}}}return t}}class d{constructor(e){this.content=e,this.content.forEach((e=>e.isInMatch=!0))}}class g{constructor(e){this.content=e,this.content.forEach((e=>e.isInMatch=!0))}}class T{constructor(e){this.content=e,this.content.forEach((e=>e.isInMatch=!0))}}class u{constructor(e){this.content=e,this.content.forEach((e=>e.isInMatch=!0))}}class f{constructor(e,t){this.scene=e,this.gridManager=t}animateTileDropping(e,t,s,i=null){e.y=t;const a=f.TILE_DROPPING_TIME;let n=0,r=0,h=0;this.scene.tweens.add({targets:e,y:s,duration:a,ease:Phaser.Math.Easing.Bounce.Out,onUpdate:()=>{const t=this.scene.time.now;if(0!==n){const s=t-n,i=e.y-r;h=i/s}n=t,r=e.y,e.scaleX=1-h*f.TILE_DROPPING_SQUASHING_CONSTANT,e.scaleY=1+h*f.TILE_DROPPING_STRETCHING_CONSTANT},onComplete:()=>{i&&i()}})}animateTileSwapping(e,t,s,i=null){const a=[],n=Phaser.Math.Easing.Circular.Out;let r=f.TILE_SWAPPING_STRETCHING_SCALE_TARGET,h=f.TILE_SWAPPING_SQUASHING_SCALE_TARGET;e.xIndex===t.xIndex&&(r=f.TILE_SWAPPING_SQUASHING_SCALE_TARGET,h=f.TILE_SWAPPING_STRETCHING_SCALE_TARGET);const o=s?100:0;a.push(this.scene.tweens.add({targets:e,x:t.x,y:t.y,ease:n,duration:f.TILE_SWAPPING_TIME,delay:o})),a.push(this.scene.tweens.add({targets:e,scaleX:r,scaleY:h,ease:Phaser.Math.Easing.Sine.InOut,duration:f.TILE_SWAPPING_TIME/2,delay:o})),a.push(this.scene.tweens.add({targets:e,scaleX:1,scaleY:1,ease:Phaser.Math.Easing.Sine.InOut,duration:f.TILE_SWAPPING_TIME/2,delay:f.TILE_SWAPPING_TIME/2+o})),a.push(this.scene.tweens.add({targets:t,x:e.x,y:e.y,ease:n,duration:f.TILE_SWAPPING_TIME,delay:o})),a.push(this.scene.tweens.add({targets:t,scaleX:r,scaleY:h,ease:Phaser.Math.Easing.Sine.InOut,duration:f.TILE_SWAPPING_TIME/2,delay:o})),a.push(this.scene.tweens.add({targets:t,scaleX:1,scaleY:1,ease:Phaser.Math.Easing.Sine.InOut,duration:f.TILE_SWAPPING_TIME/2,delay:f.TILE_SWAPPING_TIME/2+o})),a.push(this.scene.tweens.add({targets:this,duration:f.TILE_SWAPPING_TIME/2,delay:o})),i&&this.scene.time.delayedCall(f.TILE_SWAPPING_TIME,i)}}f.TILE_DROPPING_STRETCHING_CONSTANT=.12,f.TILE_DROPPING_SQUASHING_CONSTANT=.17,f.TILE_DROPPING_TIME=700,f.TILE_SWAPPING_TIME=250,f.TILE_SWAPPING_STRETCHING_SCALE_TARGET=1.5,f.TILE_SWAPPING_SQUASHING_SCALE_TARGET=.5,f.TILE_HINT_STRETCHING_SCALE_TARGET=1.3,f.TILE_HINT_SQUASHING_SCALE_TARGET=.7,f.TILE_HINT_TIME=600,f.TILE_SELECTING_SQUASHING_CONSTANT=1.2,f.TILE_COMBINING_TIME=800;const I=f;var p=Phaser.Display.Color;class y extends Phaser.GameObjects.Container{constructor(e,t,s,i,a){super(e,0,0),this.isInMatch=!1,this.followTarget=null,this.gameScene=e,this.scene.add.existing(this),this.gridManager=t,this.setSize(h.TILE_WIDTH,h.TILE_HEIGHT),this.setInteractive(),this.xIndex=s,this.yIndex=i,this.x=s*h.TILE_WIDTH,this.y=i*h.TILE_HEIGHT,this.tileType=a,this.tileImage=this.scene.add.image(0,0,this.tileType),this.tileImage.setOrigin(.5),this.add(this.tileImage),this.setScale(0),this.scene.tweens.add({targets:this,scale:1,duration:500,ease:Phaser.Math.Easing.Elastic.Out})}canMatchWith(e){return!this.isInMatch&&!e.isInMatch&&this.tileType===e.tileType}resolve(){return e=this,t=void 0,i=function*(){this.stopAllAnimation(),this.gridManager.grid[this.yIndex][this.xIndex]=null,this.gameScene.scoreManager.addScore(250),this.tileImage.setBlendMode(a.BlendModes.ADD),this.scene.tweens.addCounter({from:255,to:0,duration:500,onUpdate:e=>{this.tileImage.setTint(new p(e.getValue(),e.getValue(),e.getValue(),255).color)}}),this.scene.tweens.add({targets:this,scale:0,duration:250,ease:Phaser.Math.Easing.Back.In}),this.scene.tweens.add({targets:this.tileImage,scale:0,duration:250,ease:Phaser.Math.Easing.Back.In,onComplete:()=>this.tileImage.destroy()})},new((s=void 0)||(s=Promise))((function(a,n){function r(e){try{o(i.next(e))}catch(e){n(e)}}function h(e){try{o(i.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,h)}o((i=i.apply(e,t||[])).next())}));var e,t,s,i}playSelectedAnimation(){this.stopAllAnimation(),this.gameScene.chooseSound.play(),this.selectedAnimation=this.scene.tweens.chain({targets:this,tweens:[{scale:I.TILE_SELECTING_SQUASHING_CONSTANT,duration:50,ease:Phaser.Math.Easing.Circular.Out},{scale:1,duration:50,ease:Phaser.Math.Easing.Circular.Out},{angle:10,duration:250,ease:Phaser.Math.Easing.Circular.InOut},{angle:-10,duration:500,ease:Phaser.Math.Easing.Circular.InOut,repeat:-1,yoyo:!0}]})}stopSelectedAnimation(){var e;null===(e=this.selectedAnimation)||void 0===e||e.stop(),this.selectedAnimation=this.scene.tweens.chain({targets:this,tweens:[{scale:I.TILE_SELECTING_SQUASHING_CONSTANT,duration:50,ease:Phaser.Math.Easing.Circular.Out},{scale:1,duration:50,ease:Phaser.Math.Easing.Circular.Out},{angle:0,duration:500,ease:Phaser.Math.Easing.Circular.InOut}]})}playWakeAnimation(){this.stopAllAnimation(),this.wakeAnimation=this.scene.tweens.chain({targets:this,tweens:[{scaleX:1.2,scaleY:.8,duration:400,ease:Phaser.Math.Easing.Circular.Out},{scaleX:.8,scaleY:1.2,duration:400,ease:Phaser.Math.Easing.Circular.Out},{scaleX:1,scaleY:1,duration:400,ease:Phaser.Math.Easing.Circular.Out}]})}stopWakeAnimation(){var e;null===(e=this.wakeAnimation)||void 0===e||e.stop(),this.wakeAnimation=this.scene.tweens.add({targets:this,scaleX:1,scaleY:1,duration:400,ease:Phaser.Math.Easing.Circular.Out})}playHintAnimation(e,t){this.stopAllAnimation(),0!==e?(this.tileImage.setOrigin(e>0?1:0,.5),this.tileImage.x+=0===this.tileImage.originX?-this.tileImage.width/2:this.tileImage.width/2):(this.tileImage.setOrigin(.5,t>0?1:0),this.tileImage.y+=0===this.tileImage.originY?-this.tileImage.height/2:this.tileImage.height/2),this.hintAnimation=this.scene.tweens.chain({targets:this.tileImage,tweens:[{scaleX:0!==e?I.TILE_HINT_SQUASHING_SCALE_TARGET:I.TILE_HINT_STRETCHING_SCALE_TARGET,scaleY:0!==t?I.TILE_HINT_SQUASHING_SCALE_TARGET:I.TILE_HINT_STRETCHING_SCALE_TARGET,duration:I.TILE_HINT_TIME/4,ease:Phaser.Math.Easing.Quintic.Out,delay:100,onStart:()=>this.gameScene.squeakySound.play()},{scaleX:1,scaleY:1,delay:50,duration:I.TILE_HINT_TIME/4,ease:Phaser.Math.Easing.Quintic.Out},{scaleX:0!==e?I.TILE_HINT_SQUASHING_SCALE_TARGET:I.TILE_HINT_STRETCHING_SCALE_TARGET,scaleY:0!==t?I.TILE_HINT_SQUASHING_SCALE_TARGET:I.TILE_HINT_STRETCHING_SCALE_TARGET,duration:I.TILE_HINT_TIME/4,ease:Phaser.Math.Easing.Quintic.Out,delay:100,onStart:()=>this.gameScene.squeakySound.play()},{scaleX:1,scaleY:1,delay:50,duration:I.TILE_HINT_TIME/4,ease:Phaser.Math.Easing.Quintic.Out}],onComplete:()=>{0!==e?this.tileImage.x+=0===this.tileImage.originX?this.tileImage.width/2:-this.tileImage.width/2:this.tileImage.y+=0===this.tileImage.originY?this.tileImage.height/2:-this.tileImage.height/2,this.tileImage.setOrigin(.5)}})}playMoveAnimation(e,t){this.stopAllAnimation(),this.moveAnimation=this.scene.tweens.add({targets:this,x:e,y:t,duration:I.TILE_COMBINING_TIME,ease:Phaser.Math.Easing.Sine.InOut})}stopAllAnimation(){var e,t,s,i;null===(e=this.selectedAnimation)||void 0===e||e.stop(),null===(t=this.wakeAnimation)||void 0===t||t.stop(),null===(s=this.hintAnimation)||void 0===s||s.stop(),null===(i=this.moveAnimation)||void 0===i||i.stop()}destroy(e){this.tileImage.destroy(),super.destroy(e)}assignFollowTarget(e){this.followTarget=e}removeFollowTarget(){this.followTarget=null}moveToTarget(e){null!==this.followTarget&&(this.x=Phaser.Math.Linear(this.x,this.followTarget.x,e),this.y=Phaser.Math.Linear(this.y,this.followTarget.y,e))}reassignIndex(e,t){this.xIndex=e,this.yIndex=t}}var E=Phaser.Math.Vector3;class S{static DegreeAngleBetween(e,t){const s=e.clone(),i=t.clone();return Math.acos((s.x*i.x+s.y*i.y)/(e.length()*t.length()))*Phaser.Math.RAD_TO_DEG}static SignedDegreeAngleBetween(e,t){const s=e.clone(),i=t.clone(),a=Math.acos((s.x*i.x+s.y*i.y)/(e.length()*t.length()))*Phaser.Math.RAD_TO_DEG,n=new E(0,0,s.x*i.y-i.x*s.y);return E.FORWARD.clone().dot(n)<0?a:-a}static IsPointBetween(e,t,s){const i=Phaser.Math.Distance.BetweenPoints(t,s),a=Phaser.Math.Distance.BetweenPoints(e,t),n=Phaser.Math.Distance.BetweenPoints(e,s);return Math.abs(a+n-i)<Phaser.Math.EPSILON}static clampLength(e,t){return(e=e.clone()).length()>t&&(e=e.scale(e.length()/t)),e}static lerpVector2(e,t,s){const i=Phaser.Math.Linear(e.x,t.x,s),a=Phaser.Math.Linear(e.y,t.y,s);return new Phaser.Math.Vector2(i,a)}static lerpVector2ByDistance(e,t,s){const i=e.distance(t),a=Phaser.Math.Clamp(s/i,0,1);return S.lerpVector2(e,t,a)}static inverseLerp(e,t,s){return e===t?0:(s-e)/(t-e)}}const m=S;var O=Phaser.Math.Vector2;class M extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e);const t=Phaser.Math.RandomXY(O.ONE).scale(Phaser.Math.Between(500,750));this.startVelocityX=t.x,this.startVelocityY=t.y}update(e,t,s){if(this.lifeCurrent>350){const e=m.inverseLerp(700,350,this.lifeCurrent);this.scaleX=.75,this.scaleY=.75,this.velocityX=Phaser.Math.Linear(this.startVelocityX,0,Phaser.Math.Easing.Circular.Out(e)),this.velocityY=Phaser.Math.Linear(this.startVelocityY,0,Phaser.Math.Easing.Circular.Out(e))}else if(this.lifeCurrent<=250){const e=m.inverseLerp(250,0,this.lifeCurrent);this.scaleX=this.scaleY=Phaser.Math.Linear(.75,0,Phaser.Math.Easing.Sine.InOut(e)),this.lifeCurrent<=5&&(this.scaleX=this.scaleY=0)}return super.update(e,t,s)}}const _=M;var A=Phaser.Math.Vector2;const P=class extends y{resolve(){const e=Object.create(null,{resolve:{get:()=>super.resolve}});return t=this,s=void 0,a=function*(){e.resolve.call(this),this.gameScene.time.delayedCall(200,(()=>this.scene.add.particles(this.x,this.y,this.tileType,{lifespan:700,rotate:{start:0,min:0,max:360},emitting:!1,particleClass:_}).explode(Phaser.Math.Between(2,3)))),this.setDepth(10),this.scene.cameras.main.shake(50,new A(.003,.003)),yield new Promise((e=>{setTimeout((()=>{e()}),100)}))},new((i=void 0)||(i=Promise))((function(e,n){function r(e){try{o(a.next(e))}catch(e){n(e)}}function h(e){try{o(a.throw(e))}catch(e){n(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,h)}o((a=a.apply(t,s||[])).next())}));var t,s,i,a}};const v=class extends y{constructor(e,t,s,i,a){super(e,t,s,i,a),this.fireImage=this.scene.add.image(0,0,r.Sprite.FIRE),this.add(this.fireImage)}resolve(){const e=Object.create(null,{resolve:{get:()=>super.resolve}});var t,s,i,a,n,r,h,o,l,c,d,g;return l=this,c=void 0,g=function*(){e.resolve.call(this),yield null===(t=this.gridManager.getTileByOffset(this,-1,-1))||void 0===t?void 0:t.resolve(),yield null===(s=this.gridManager.getTileByOffset(this,-1,0))||void 0===s?void 0:s.resolve(),yield null===(i=this.gridManager.getTileByOffset(this,-1,1))||void 0===i?void 0:i.resolve(),yield null===(a=this.gridManager.getTileByOffset(this,0,-1))||void 0===a?void 0:a.resolve(),yield null===(n=this.gridManager.getTileByOffset(this,0,1))||void 0===n?void 0:n.resolve(),yield null===(r=this.gridManager.getTileByOffset(this,1,-1))||void 0===r?void 0:r.resolve(),yield null===(h=this.gridManager.getTileByOffset(this,1,0))||void 0===h?void 0:h.resolve(),yield null===(o=this.gridManager.getTileByOffset(this,1,1))||void 0===o?void 0:o.resolve(),this.scene.tweens.add({targets:this.fireImage,scale:0,duration:500,ease:Phaser.Math.Easing.Cubic.Out,onComplete:()=>this.fireImage.destroy()})},new((d=void 0)||(d=Promise))((function(e,t){function s(e){try{a(g.next(e))}catch(e){t(e)}}function i(e){try{a(g.throw(e))}catch(e){t(e)}}function a(t){var a;t.done?e(t.value):(a=t.value,a instanceof d?a:new d((function(e){e(a)}))).then(s,i)}a((g=g.apply(l,c||[])).next())}))}};const x=class extends y{constructor(e,t,s,i){super(e,t,s,i,r.Sprite.STAR)}resolve(){const e=Object.create(null,{resolve:{get:()=>super.resolve}});var t,s,i,a,n,h,o,l,c,d;return o=this,l=void 0,d=function*(){e.resolve.call(this);let o=null===(t=this.gridManager.firstSelectedTile)||void 0===t?void 0:t.tileType;if(o===r.Sprite.STAR)if((null===(s=this.gridManager.secondSelectedTile)||void 0===s?void 0:s.tileType)===r.Sprite.STAR)for(let e=0;e<this.gridManager.gridHeight;e++)for(let t=0;t<this.gridManager.gridWidth;t++)yield null===(i=this.gridManager.grid[e][t])||void 0===i?void 0:i.resolve();else o=null===(a=this.gridManager.secondSelectedTile)||void 0===a?void 0:a.tileType;for(let e=0;e<this.gridManager.gridHeight;e++)for(let t=0;t<this.gridManager.gridWidth;t++)(null===(n=this.gridManager.grid[e][t])||void 0===n?void 0:n.tileType)===o&&(yield null===(h=this.gridManager.grid[e][t])||void 0===h?void 0:h.resolve())},new((c=void 0)||(c=Promise))((function(e,t){function s(e){try{a(d.next(e))}catch(e){t(e)}}function i(e){try{a(d.throw(e))}catch(e){t(e)}}function a(t){var a;t.done?e(t.value):(a=t.value,a instanceof c?a:new c((function(e){e(a)}))).then(s,i)}a((d=d.apply(o,l||[])).next())}))}};class G extends Phaser.GameObjects.Container{constructor(e){super(e)}}const L=G;var C;!function(e){e.INITIALIZING="INITIALIZING",e.IDLE="IDLE",e.MOVING="MOVING",e.SWAPPING="SWAPPING",e.CALCULATE="CALCULATE",e.MERGING="MERGING",e.CLEARING="CLEARING",e.DROPPING="DROPPING",e.SHUFFLING="SHUFFLING"}(C||(C={}));var H=Phaser.Math.Vector2;class w extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e),this.targetAngle=Phaser.Math.Between(-400,750),this.emitter.scene.time.delayedCall(0,(()=>{this.startAngle=Phaser.Math.Between(-10,10)/100*Phaser.Math.RAD_TO_DEG+90;const e=new H(0,this.velocityY).rotate((this.startAngle-90)*Phaser.Math.DEG_TO_RAD);this.velocityX=e.x,this.velocityY=e.y}))}update(e,t,s){if(this.velocityY<0)this.velocityX*=1.01,this.angle=this.startAngle;else{this.velocityX*=.9,this.velocityY*=.3;const e=Phaser.Math.Clamp(m.inverseLerp(3e3,0,this.lifeCurrent),0,1);this.alpha=Phaser.Math.Linear(1,0,Phaser.Math.Easing.Quartic.In(e))}return this.angle=Phaser.Math.Linear(this.startAngle,this.targetAngle,Phaser.Math.Easing.Sine.In(this.lifeT)),super.update(e,t,s)}}const R=w;class N extends Phaser.GameObjects.Container{constructor(e){super(e,0,0),this.targetScore=12e3,this.currentScore=0,this.currentProgressBarScore=0,this.scoreMultiplier=1,this.milestonesReached=0,e.add.group([this],{runChildUpdate:!0}),this.gameScene=e,this.progressBar=this.scene.add.graphics(),this.progressBar.setDepth(-100),this.progressBar.fillStyle(4473924,1),this.progressBar.fillRoundedRect(-.5*h.TILE_HEIGHT,8*h.TILE_HEIGHT,8*h.TILE_HEIGHT,5,2.5),this.progressBarBackground=this.scene.add.graphics(),this.progressBarBackground.setDepth(-101),this.progressBarBackground.fillStyle(13421772,1),this.progressBarBackground.fillRoundedRect(-.5*h.TILE_HEIGHT,8*h.TILE_HEIGHT,8*h.TILE_HEIGHT,5,2.5),this.star1=e.add.image(-.5*h.TILE_HEIGHT+8*h.TILE_HEIGHT/3,8*h.TILE_HEIGHT,r.Sprite.PROGRESS_STAR),this.star1.setTint(13421772),this.star1.setOrigin(.5),this.star1.setDepth(0),this.star1.setDisplaySize(24,24),this.star1Background=e.add.image(-.5*h.TILE_HEIGHT+8*h.TILE_HEIGHT/3,8*h.TILE_HEIGHT,r.Sprite.PROGRESS_STAR),this.star1Background.setTint(15658734),this.star1Background.setOrigin(.5),this.star1Background.setDepth(-1),this.star1Background.setDisplaySize(32,32),this.star2=e.add.image(-.5*h.TILE_HEIGHT+8*h.TILE_HEIGHT/3*2,8*h.TILE_HEIGHT,r.Sprite.PROGRESS_STAR),this.star2.setTint(13421772),this.star2.setOrigin(.5),this.star2.setDepth(0),this.star2.setDisplaySize(24,24),this.star2Background=e.add.image(-.5*h.TILE_HEIGHT+8*h.TILE_HEIGHT/3*2,8*h.TILE_HEIGHT,r.Sprite.PROGRESS_STAR),this.star2Background.setTint(15658734),this.star2Background.setOrigin(.5),this.star2Background.setDepth(-1),this.star2Background.setDisplaySize(32,32),this.star3=e.add.image(-.5*h.TILE_HEIGHT+8*h.TILE_HEIGHT/3*3,8*h.TILE_HEIGHT,r.Sprite.PROGRESS_STAR),this.star3.setTint(13421772),this.star3.setOrigin(.5),this.star3.setDepth(0),this.star3.setDisplaySize(24,24),this.star3Background=e.add.image(-.5*h.TILE_HEIGHT+8*h.TILE_HEIGHT/3*3,8*h.TILE_HEIGHT,r.Sprite.PROGRESS_STAR),this.star3Background.setTint(15658734),this.star3Background.setOrigin(.5),this.star3Background.setDepth(-1),this.star3Background.setDisplaySize(32,32)}addScore(e){this.gameScene.playPopSound(300*(this.scoreMultiplier-1)),this.currentScore+=e*this.scoreMultiplier,this.scoreMultiplier+=.1,this.currentScore>=4e3&&0===this.milestonesReached?(this.gameScene.cheersSound.play(),this.star1.setTint(4473924),this.milestonesReached=1,this.gameScene.tweens.add({targets:this.star1,angle:360,duration:500,ease:Phaser.Math.Easing.Sine.InOut}),this.explodeConfetti(this.star1.x,this.star1.y),this.gameScene.gridManager.awaitingShuffle=!0):this.currentScore>=8e3&&1===this.milestonesReached?(this.gameScene.cheersSound.play(),this.star2.setTint(4473924),this.milestonesReached=2,this.gameScene.tweens.add({targets:this.star2,angle:360,duration:500,ease:Phaser.Math.Easing.Sine.InOut}),this.explodeConfetti(this.star2.x,this.star2.y),this.gameScene.gridManager.awaitingShuffle=!0):this.currentScore>=12e3&&2===this.milestonesReached&&(this.gameScene.cheersSound.play(),this.star3.setTint(4473924),this.milestonesReached=3,this.gameScene.tweens.add({targets:this.star3,angle:360,duration:500,ease:Phaser.Math.Easing.Sine.InOut}),this.explodeConfetti(this.star3.x,this.star3.y),this.gameScene.gridManager.awaitingShuffle=!0)}explodeConfetti(e,t){const s=Phaser.Display.Color.HSVColorWheel(.8,.9).map((e=>e.color));this.gameScene.add.particles(e,t,r.Sprite.CONFETTI,{lifespan:{min:4e3,max:6e3},speedY:{min:-750,max:-2e3},gravityY:2e3,scale:{min:.1,max:.5},tint:s,emitting:!0,particleClass:R}).explode(Phaser.Math.Between(50,100)),this.gameScene.add.particles(e,t,r.Sprite.CONFETTI_FLIPPED,{lifespan:{min:4e3,max:6e3},speedY:{min:-750,max:-2e3},gravityY:2e3,scale:{min:.1,max:.5},tint:s,emitting:!0,particleClass:R}).explode(Phaser.Math.Between(50,100))}resetMultiplier(){this.scoreMultiplier=1}update(e,t){this.currentProgressBarScore<this.currentScore&&(this.currentProgressBarScore+=10*t);const s=Phaser.Math.Clamp(this.currentProgressBarScore/this.targetScore,0,1);this.progressBar.clear(),this.progressBar.fillStyle(4473924,1),this.progressBar.fillRoundedRect(-.5*h.TILE_HEIGHT,8*h.TILE_HEIGHT,8*h.TILE_HEIGHT*s,5,2.5)}}const B=N;class k extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.popSounds=[]}create(){this.cameras.main.setBackgroundColor(15658734),this.cameras.main.centerOn(3.5*h.TILE_WIDTH,4*h.TILE_HEIGHT),this.gridManager=new class{constructor(e,t,s,i){this.stateMachine=new class{constructor(e,t=!1){this.onEntryCallbacks=[],this.onExitCallbacks=[],this._currentState=e,this.sameStateInvoke=t}get currentState(){return this._currentState}changeState(e){if(console.log(e),this.sameStateInvoke||this._currentState!==e){this._currentState=e,console.log("enter: "+e);for(let e=0;e<this.onExitCallbacks.length;e++)this.onExitCallbacks[e].state===this._currentState&&this.onExitCallbacks[e].callback();for(let t=0;t<this.onEntryCallbacks.length;t++)this.onEntryCallbacks[t].state===e&&this.onEntryCallbacks[t].callback()}}configure(e){return this.configuringState=e,this}onEntry(e){return this.onEntryCallbacks.push(new o(this.configuringState,e)),this}onExit(e){return this.onExitCallbacks.push(new o(this.configuringState,e)),this}}(C.INITIALIZING),this.canMove=!1,this.awaitingShuffle=!1,this.followTargets=[],this.gameScene=e,this.gridWidth=t,this.gridHeight=s,this.possibleItemTypes=i,this.animationFactory=new I(e,this),this.gameScene.input.on(Phaser.Input.Events.GAMEOBJECT_DOWN,this.moveTile,this),this.stateMachine.configure(C.IDLE).onEntry((()=>{this.resetWakeTimer(),this.gameScene.scoreManager.resetMultiplier(),this.deselectTiles()})),this.stateMachine.configure(C.SWAPPING).onEntry((()=>{this.swapTile(),this.stopWakeTimer()})),this.stateMachine.configure(C.CALCULATE).onEntry((()=>{this.updateResolveResult()})),this.stateMachine.configure(C.CLEARING).onEntry((()=>{this.stopWakeTimer(),this.clearGroups()})),this.stateMachine.configure(C.DROPPING).onEntry((()=>{this.dropAndFill()})),this.stateMachine.configure(C.SHUFFLING).onEntry((()=>{this.awaitingShuffle=!1,this.shuffle()})),this.resetWakeTimer(),this.initGrid()}initGrid(){this.grid=[];for(let e=0;e<this.gridHeight;e++){const e=[];for(let t=0;t<this.gridWidth;t++)e.push(null),this.followTargets.push(new L(this.gameScene));this.grid.push(e)}this.stateMachine.changeState(C.DROPPING)}update(){console.log("===================="),console.log(this.firstSelectedTile),console.log(this.secondSelectedTile)}addRandomItem(e,t){const s=Math.floor(Math.random()*this.possibleItemTypes.length),i=this.possibleItemTypes[s],a=new P(this.gameScene,this,e,t,i);this.grid[t][e]=a,this.animationFactory.animateTileDropping(this.grid[t][e],a.y-this.gridHeight*h.TILE_HEIGHT,a.y)}moveTile(e,t,s){if(this.stateMachine.currentState===C.IDLE){if(this.firstSelectedTile){if(this.secondSelectedTile=t,this.firstSelectedTile===this.secondSelectedTile)return void this.deselectTiles();const e=Math.abs(this.firstSelectedTile.xIndex-this.secondSelectedTile.xIndex),s=Math.abs(this.firstSelectedTile.yIndex-this.secondSelectedTile.yIndex);1===e&&0===s||0===e&&1===s?(this.canMove=!1,this.stateMachine.changeState(C.SWAPPING)):this.deselectTiles()}else this.firstSelectedTile=t,this.firstSelectedTile.playSelectedAnimation();this.wakeUpTimer.reset({})}}swapTile(e=!1){this.matchesClearedThisMove=0;const t=this.firstSelectedTile,s=this.secondSelectedTile;this.grid[t.yIndex][t.xIndex]=s,this.grid[s.yIndex][s.xIndex]=t;const i=s.xIndex,a=s.yIndex;s.xIndex=t.xIndex,s.yIndex=t.yIndex,t.xIndex=i,t.yIndex=a,e?(this.deselectTiles(),this.animationFactory.animateTileSwapping(t,s,!0)):this.animationFactory.animateTileSwapping(t,s,!1,(()=>{this.stateMachine.changeState(C.CALCULATE)})),this.gameScene.swapSound.play()}deselectTiles(){var e,t;null===(e=this.firstSelectedTile)||void 0===e||e.stopAllAnimation(),null===(t=this.secondSelectedTile)||void 0===t||t.stopAllAnimation(),this.firstSelectedTile=null,this.secondSelectedTile=null}updateResolveResult(){var e,t;this.resolveResult=new c(this.grid),this.matchesClearedThisMove+=this.resolveResult.totalMatches,this.resolveResult.totalMatches>0||(null===(e=this.firstSelectedTile)||void 0===e?void 0:e.tileType)===r.Sprite.STAR||(null===(t=this.secondSelectedTile)||void 0===t?void 0:t.tileType)===r.Sprite.STAR?this.stateMachine.changeState(C.CLEARING):(0===this.matchesClearedThisMove&&this.swapTile(!0),this.awaitingShuffle?this.stateMachine.changeState(C.SHUFFLING):this.stateMachine.changeState(C.IDLE))}clearGroups(){var e,t,s,i,a,n;return s=this,i=void 0,n=function*(){(null===(e=this.firstSelectedTile)||void 0===e?void 0:e.tileType)===r.Sprite.STAR&&(yield this.firstSelectedTile.resolve()),(null===(t=this.secondSelectedTile)||void 0===t?void 0:t.tileType)===r.Sprite.STAR&&(yield this.secondSelectedTile.resolve());for(const e of this.resolveResult.matchesOfFiveStraight){for(const t of e.content)yield t.resolve();const t=e.content[2];this.gameScene.cameras.main.pan(t.x,t.y,500,Phaser.Math.Easing.Cubic.Out),this.gameScene.cameras.main.rotateTo(.05*Math.random(),!0,500,Phaser.Math.Easing.Cubic.Out),this.gameScene.cameras.main.zoomTo(1.5,500,Phaser.Math.Easing.Cubic.Out),yield new Promise(((e,s)=>{setTimeout((()=>{const s=new x(this.gameScene,this,t.xIndex,t.yIndex);this.grid[t.yIndex][t.xIndex]=s,this.gameScene.starSound.play(),setTimeout((()=>{this.gameScene.cameras.main.pan(3.5*h.TILE_WIDTH,4*h.TILE_HEIGHT,500,Phaser.Math.Easing.Cubic.Out),this.gameScene.cameras.main.rotateTo(0,!0,500,Phaser.Math.Easing.Cubic.Out),this.gameScene.cameras.main.zoomTo(1,500,Phaser.Math.Easing.Cubic.Out),setTimeout((()=>{e()}),500)}),500)}),500)}))}for(const e of this.resolveResult.matchesOfFiveAngled)for(const t of e.content)yield t.resolve();for(const e of this.resolveResult.matchesOfFour){for(const t of e.content)yield t.resolve();const t=l.getRandomElement(e.content),s=new v(this.gameScene,this,t.xIndex,t.yIndex,t.tileType);this.grid[t.yIndex][t.xIndex]=s}for(const e of this.resolveResult.matchesOfThree)for(const t of e.content)yield t.resolve();this.deselectTiles(),this.stateMachine.changeState(C.DROPPING)},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{o(n.next(e))}catch(e){t(e)}}function h(e){try{o(n.throw(e))}catch(e){t(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(r,h)}o((n=n.apply(s,i||[])).next())}))}dropAndFill(){for(let e=0;e<this.gridWidth;e++){let t=0;for(let s=this.gridHeight-1;s>=0;s--){const i=this.grid[s][e];if(null===i)t++;else if(t>0){const a=s+t;i.yIndex=a,this.animationFactory.animateTileDropping(i,i.y,a*h.TILE_HEIGHT),this.grid[a][e]=i,this.grid[s][e]=null}}}for(let e=0;e<this.gridHeight;e++)for(let t=0;t<this.gridWidth;t++)null===this.grid[e][t]&&this.addRandomItem(t,e);this.gameScene.time.delayedCall(I.TILE_DROPPING_TIME,(()=>{this.stateMachine.changeState(C.CALCULATE)}))}resetWakeTimer(){var e;null===(e=this.wakeUpTimer)||void 0===e||e.destroy(),this.wakeUpTimer=this.gameScene.time.addEvent({delay:3e3,callback:()=>{var e;const t=this.findPotentialMatch();null!==t&&(null===(e=this.grid[t.yIndex][t.xIndex])||void 0===e||e.playHintAnimation(t.xOffset,t.yOffset),this.resetWakeTimer())}})}stopWakeTimer(){var e;null===(e=this.wakeUpTimer)||void 0===e||e.destroy()}findPotentialMatch(){for(let e=0;e<this.gridHeight;e++)for(let t=0;t<this.gridWidth;t++){const s=this.grid[e][t];if(this.getTileTypeByOffset(s,-1,-1)===s.tileType){if(this.getTileTypeByOffset(s,-2,-1)===s.tileType||this.getTileTypeByOffset(s,1,-1)===s.tileType)return console.log(1),{xIndex:t,yIndex:e,xOffset:0,yOffset:-1};if(this.getTileTypeByOffset(s,-1,-2)===s.tileType||this.getTileTypeByOffset(s,-1,1)===s.tileType)return console.log(2),{xIndex:t,yIndex:e,xOffset:-1,yOffset:0}}if(this.getTileTypeByOffset(s,1,-1)===s.tileType){if(this.getTileTypeByOffset(s,2,-1)===s.tileType||this.getTileTypeByOffset(s,-1,-1)===s.tileType)return console.log(3),{xIndex:t,yIndex:e,xOffset:0,yOffset:-1};if(this.getTileTypeByOffset(s,1,-2)===s.tileType||this.getTileTypeByOffset(s,1,1)===s.tileType)return console.log(4),{xIndex:t,yIndex:e,xOffset:1,yOffset:0}}if(this.getTileTypeByOffset(s,1,1)===s.tileType){if(this.getTileTypeByOffset(s,2,1)===s.tileType||this.getTileTypeByOffset(s,-1,1)===s.tileType)return console.log(5),{xIndex:t,yIndex:e,xOffset:0,yOffset:1};if(this.getTileTypeByOffset(s,1,2)===s.tileType||this.getTileTypeByOffset(s,1,-1)===s.tileType)return console.log(6),{xIndex:t,yIndex:e,xOffset:1,yOffset:0}}if(this.getTileTypeByOffset(s,-1,1)===s.tileType){if(this.getTileTypeByOffset(s,-2,1)===s.tileType||this.getTileTypeByOffset(s,1,1)===s.tileType)return console.log(7),{xIndex:t,yIndex:e,xOffset:0,yOffset:1};if(this.getTileTypeByOffset(s,-1,2)===s.tileType||this.getTileTypeByOffset(s,-1,-1)===s.tileType)return console.log(8),{xIndex:t,yIndex:e,xOffset:-1,yOffset:0}}if(this.getTileTypeByOffset(s,0,-2)===s.tileType&&this.getTileTypeByOffset(s,0,-3)===s.tileType)return console.log(9),{xIndex:t,yIndex:e,xOffset:0,yOffset:-1};if(this.getTileTypeByOffset(s,0,2)===s.tileType&&this.getTileTypeByOffset(s,0,3)===s.tileType)return console.log(10),{xIndex:t,yIndex:e,xOffset:0,yOffset:1};if(this.getTileTypeByOffset(s,-2,0)===s.tileType&&this.getTileTypeByOffset(s,-3,0)===s.tileType)return console.log(11),{xIndex:t,yIndex:e,xOffset:-1,yOffset:0};if(this.getTileTypeByOffset(s,2,0)===s.tileType&&this.getTileTypeByOffset(s,3,0)===s.tileType)return console.log(12),{xIndex:t,yIndex:e,xOffset:1,yOffset:0}}return null}getTileByOffset(e,t,s){const i=e.xIndex+t,a=e.yIndex+s;return a<0||a>=this.gridHeight||i<0||i>=this.gridWidth?null:this.grid[a][i]}getTileTypeByOffset(e,t,s){const i=e.xIndex+t,a=e.yIndex+s;return a<0||a>=this.gridHeight||i<0||i>=this.gridWidth?null:this.grid[a][i].tileType}shuffle(){let e=[];for(let t=0;t<this.gridHeight;t++)for(let s=0;s<this.gridWidth;s++){const i=this.grid[t][s];e.push(i),i.assignFollowTarget(this.followTargets[8*t+s])}this.followTargets=l.shuffleArray(this.followTargets),e=l.shuffleArray(e);const t=new Phaser.Geom.Circle(3.5*h.TILE_HEIGHT,3.5*h.TILE_HEIGHT,200);Phaser.Actions.PlaceOnCircle(this.followTargets,t),this.gameScene.tweens.add({targets:t,radius:228,ease:Phaser.Math.Easing.Sine.InOut,duration:1e3,yoyo:!0,repeat:1,onUpdate:s=>{Phaser.Actions.RotateAroundDistance(this.followTargets,{x:3.5*h.TILE_HEIGHT,y:3.5*h.TILE_HEIGHT},.02,t.radius),e.forEach((e=>e.moveToTarget(s.progress)))},onComplete:()=>{for(let t=0;t<this.gridHeight;t++)for(let s=0;s<this.gridWidth;s++)this.grid[t][s]=e[t*this.gridHeight+s],e[t*this.gridHeight+s].reassignIndex(s,t),this.grid[t][s].followTarget.x=s*h.TILE_WIDTH,this.grid[t][s].followTarget.y=t*h.TILE_HEIGHT;this.gameScene.tweens.addCounter({from:0,to:1,duration:1e3,ease:Phaser.Math.Easing.Sine.InOut,onUpdate:t=>{e.forEach((e=>e.moveToTarget(t.getValue())))},onComplete:()=>{e.forEach((e=>e.removeFollowTarget())),this.stateMachine.changeState(C.CALCULATE)}})}})}}(this,8,8,h.CANDY_TYPES),this.scoreManager=new B(this),this.squeakySound=this.sound.add("squeak");for(let e=0;e<10;e++)this.popSounds.push(this.sound.add("pop"));this.swapSound=this.sound.add("swap"),this.cheersSound=this.sound.add("cheers"),this.starSound=this.sound.add("star"),this.chooseSound=this.sound.add("choose")}playPopSound(e){for(let t=0;t<10;t++)if(!this.popSounds[t].isPlaying)return this.popSounds[t].setDetune(e),void this.popSounds[t].play()}}const D={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",width:700,height:700,type:Phaser.AUTO,scale:{mode:Phaser.Scale.RESIZE},parent:"game",scene:[n,k],backgroundColor:"#eeeeee",render:{pixelArt:!1,antialias:!0}};class W extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new W(D)}))}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,s,a,n)=>{if(!s){var r=1/0;for(c=0;c<e.length;c++){for(var[s,a,n]=e[c],h=!0,o=0;o<s.length;o++)(!1&n||r>=n)&&Object.keys(i.O).every((e=>i.O[e](s[o])))?s.splice(o--,1):(h=!1,n<r&&(r=n));if(h){e.splice(c--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,a,n]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[r,h,o]=s,l=0;if(r.some((t=>0!==e[t]))){for(a in h)i.o(h,a)&&(i.m[a]=h[a]);if(o)var c=o(i)}for(t&&t(s);l<r.length;l++)n=r[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(c)},s=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=i.O(void 0,[216],(()=>i(447)));a=i.O(a)})();